<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasarela | Programador GS</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>
<body class="cyber-bg">
    <div class="checkout-container">
        <div class="glow-box">
            <header class="checkout-header">
                <h1 class="glitch-text" data-text="PROGRAMADOR GS">PROGRAMADOR GS</h1>
                <p class="subtitle">Secure SaaS Payment Gateway</p>
            </header>

            <main class="checkout-card">
                <div id="status-area">
                    <div id="loading" class="cyber-loader">
                        <div class="scanner"></div>
                        <p>VERIFICANDO CREDENCIALES...</p>
                    </div>
                </div>
                
                <div id="checkout-details" style="display: none;">
                    <div class="plan-badge" id="plan-name">PLAN</div>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>CLIENTE</label>
                            <span id="gym-name">--</span>
                        </div>
                        <div class="info-item">
                            <label>TOTAL</label>
                            <span id="plan-price" class="neon-text">--</span>
                        </div>
                    </div>
                    
                    <div id="wallet_container" class="mp-wallet"></div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const tenantId = urlParams.get('tenantId');
        const planId = urlParams.get('planId');
        const mp = new MercadoPago('TU_PUBLIC_KEY'); 

        async function init() {
            try {
                const response = await fetch(`/api/checkout/saas?tenantId=${tenantId}&planId=${planId}`);
                const data = await response.json();

                document.getElementById('gym-name').innerText = data.tenant.Name;
                document.getElementById('plan-name').innerText = data.plan.Name.toUpperCase();
                document.getElementById('plan-price').innerText = `$${data.plan.Price} ARS`;
                
                const prefRes = await fetch('/api/create-preference', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tenantId: tenantId,
                        planEnumId: planId,
                        price: data.plan.Price,
                        title: data.plan.Name,
                        emailGimnasio: data.tenant.Email
                    })
                });

                const prefData = await prefRes.json();

                mp.bricks().create("wallet", "wallet_container", {
                    initialization: { preferenceId: prefData.preferenceId },
                    customization: { texts: { valueProp: 'smart_option' } }
                });

                document.getElementById('status-area').style.display = 'none';
                document.getElementById('checkout-details').style.display = 'block';

            } catch (err) {
                document.getElementById('status-area').innerHTML = `<p class="error-text">ERROR: ${err.message}</p>`;
            }
        }
        init();
    </script>
</body>
</html>